
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hexo">
    <title>prototype-pattern - Hexo</title>
    <meta name="author" content="Shiladitya Bose">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Shiladitya Bose","sameAs":["https://github.com/s-bose","https://stackoverflow.com/users/5094261/shiladitya-bose","https://www.linkedin.com/in/shiladitya-bose/","mailto:shiladitya.bose@outlook.com"],"image":"avatar.jpg"},"articleBody":"IntroductionSome questions first, we know that in order to implement polymorphism the right way, i.e, dynamic binding and LSP (Liskov Substitution Principle), we have to make the functions virtual, sometimes pure virtual, and then reimplement them in the Derived class with an override keyword.\nWe also need to separate the interface from the implementation, i.e, make the virtual function to be overriden private, and make a proxy public interface function in Base that simply calls the private function. We only need to reimplement the private virtual function in Derived. A simple example is shown below.\n12345678910111213141516171819202122232425262728293031323334353637class Base&#123;\tpublic:\t\tvoid call() const;\tprivate:\t\tvirtual void vCall(); // override in derived\t\t// virtual void vCall() = 0; // pure virtual, if base has nothing to do&#125;;inline void Base::call() const&#123;\tvCall();&#125;void Base::vHello()&#123;\tstd::cout &lt;&lt; &quot;Base vHello called\\n&quot;;&#125;class Derived: public Base&#123;\tprivate:\t\tvoid vHello() override;&#125;;void Derived::vHello()&#123;\tstd::cout &lt;&lt; &quot;Derived vHello called\\n&quot;;&#125;int main()&#123;\tBase *bp = new Derived;\tBase *bp1 = new Base;\tbp-&gt;hello(); // Derived\tbp1-&gt;hello(); // Base&#125;\n\nThis is pretty standard when it comes to providing polymorphic support for some member functions. In addition, if Base class acquires some dynamic memory it also needs to free them, therefore providing a destructor, but the problem is, if Base only has a normal destructor, then using LSP, the Base pointer pointing to a Derived object, once out of scope, will trigger the destructor for Base class only, since there is no v_table entry for destructor, thus if Derived also has some dynamic allocation, they cannot be freed, leading to memory leak. Thus, we also have virtual destructors which work pretty much the same way.\nVirtual Constructor???Well, it does not make sense. In order for virtual constructor to work, we need to have a v_ptr entry for the address of the constructor function.\nbut the constructor of a class should have the same type as the class itself. But at the time of construction, the type does not exist yet, as the class object hasn’t been created yet, so we don’t know what the v_ptr should point to, it creates a paradox.\nAt the same time, v_ptr and vtables are items instantiated for each class objects. There is no vtable before the object creation.\nat the time of calling the constructor, the virtual table would not have been created to resolve any virtual function calls. Thus, a virtual constructor itself would not have anywhere to look up to.\nSuch is the reason why the variants of constructors, such as copy or move constructors also cannot be made virtual.\nBut we can get around that problem using Prototype design pattern. We want to be able to create copies of a Derived object through a Base ptr or ref to that Derived obj (using LSP).\nIn this protocol, we make the Base class an abstract base class (ABC), with atleast one pure virtual function, and it does not have a copy constructor.\nGenerally, it has two functions, a public interface clone() and a private pure virtual, copy() signalling reimplementation in Derived classes.\n12345678910111213141516171819class Base&#123;\tpublic:\t\tBase(Base const &amp;) = delete;\t\tvirtual ~Base();\t\tBase *clone() const;\tprivate:\t\tvirtual Base *copy() = 0;&#125;;inline Base *Base::clone() const&#123;\treturn copy();&#125;// not inlineBase::~Base()&#123;&#125;\n\nWe offer a Wrapper class over Base that provides the copy functionalities:\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859class Wrapper&#123;\tBase *d_bp;\t\tpublic:\t\tWrapper();\t\texplicit Wrapper(Wrapper *bp);\t\t~Wrapper();\t\tWrapper(Wrapper const &amp;other);\t\tWrapper(Wrapper &amp;&amp;tmp);\t\tWrapper &amp;operator=(Wrapper const &amp;other);\t\tWrapper &amp;operator=(Wrapper &amp;&amp;tmp);\t\tBase &amp;getBase() const;&#125;;inline Wrapper::Wrapper():\td_bp(0)&#123;&#125;inline Wrapper::Wrapper(Wrapper *bp):\td_bp(bp)&#123;&#125;inline Wrapper::~Wrapper()&#123;\tdelete d_bp;&#125;inline Wrapper::Wrapper(Wrapper const &amp;other):\td_bp(other.d_bp-&gt;clone())&#123;&#125;inline Wrapper::Wrapper(Wrapper &amp;&amp;tmp):\td_bp(tmp.d_bp)&#123;\ttmp.d_bp = 0;&#125;inline Base &amp;Wrapper::getBase() const&#123;\treturn *d_bp;&#125;Wrapper &amp;Wrapper::operator=(Wrapper const &amp;other)&#123;\tWrapper tmp(other);\tstd::swap(d_bp, tmp.d_bp);\treturn *this;&#125;Wrapper &amp;Wrapper::operator=(Wrapper &amp;&amp;tmp)&#123;\tstd::swap(d_bp, tmp.d_bp);\treturn *this;&#125;\n\nThe Wrapper class exists to provide a unified copy-able interface for the entire family that derives from Base, all the Derived class needs to do is implement its virtual copy() method to return a new pointer to a copy of this \n123456789101112class Derived: public Base&#123;\tpublic:\t\t~Derived() override;\tprivate:\t\tBase *copy() const override;&#125;;inline Base *Derived::copy() const&#123;\treturn new Derived(*this);&#125;\n\nNo Copy/move constructor for polymorphic Base?According to C++ guidelines, C.67, A polymorphic class should suppress public copy/move\nC++ Core Guidelines\nThis is because, whenever the polymorphic Base class has implicitly defined copy/move constructors in place, \nIf it is accidentally passed by value, with the implicitly generated copy constructor and assignment, we risk slicing: only the base portion of a derived object will be copied, and the polymorphic behaviour will be corrupted.\nThis is why, we have to either delete the implicit copy/move constructor like we did in the last example, if the Base class does not have any data, or else make the constructors protected, so the copying can only be done from the context of Derived class.\nFor more example, the link is useful, check C.67 for this particular issue. –&gt;\n","dateCreated":"2022-03-22T23:19:04+05:30","dateModified":"2022-03-23T06:59:41+05:30","datePublished":"2022-03-22T23:19:04+05:30","description":"","headline":"prototype-pattern","image":["cpp.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://s-bose.github.io/2022/03/22/prototype-pattern/"},"publisher":{"@type":"Organization","name":"Shiladitya Bose","sameAs":["https://github.com/s-bose","https://stackoverflow.com/users/5094261/shiladitya-bose","https://www.linkedin.com/in/shiladitya-bose/","mailto:shiladitya.bose@outlook.com"],"image":"avatar.jpg","logo":{"@type":"ImageObject","url":"avatar.jpg"}},"url":"https://s-bose.github.io/2022/03/22/prototype-pattern/","keywords":"design pattern, cpp, inheritance","thumbnailUrl":"cpp.png"}</script>
    <meta name="description" content="IntroductionSome questions first, we know that in order to implement polymorphism the right way, i.e, dynamic binding and LSP (Liskov Substitution Principle), we have to make the functions virtual, so">
<meta property="og:type" content="blog">
<meta property="og:title" content="prototype-pattern">
<meta property="og:url" content="https://s-bose.github.io/2022/03/22/prototype-pattern/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="IntroductionSome questions first, we know that in order to implement polymorphism the right way, i.e, dynamic binding and LSP (Liskov Substitution Principle), we have to make the functions virtual, so">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-03-22T17:49:04.000Z">
<meta property="article:modified_time" content="2022-03-23T01:29:41.575Z">
<meta property="article:author" content="Shiladitya Bose">
<meta property="article:tag" content="design pattern">
<meta property="article:tag" content="cpp">
<meta property="article:tag" content="inheritance">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://s-bose.github.io/assets/images/avatar.jpg"/>
    
    
        <meta property="og:image" content="https://s-bose.github.io/2022/03/22/prototype-pattern/cpp.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://s-bose.github.io/2022/03/22/prototype-pattern/cpp.png"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-rtbx56i4odq2bmdkfkw0tuu3b2m9dr8f4v8xczcezp2njcafsmyh79erc4pp.min.css">

    <!--STYLES END-->
    

    

    
        
            
<link rel="stylesheet" href="/assets/css/gitalk.css">

        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Hexo
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Shiladitya Bose</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I like working on stuffs, and making stuffs work.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/s-bose"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/5094261/shiladitya-bose"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/shiladitya-bose/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:shiladitya.bose@outlook.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            prototype-pattern
        </h1>
    
    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Some questions first, we know that in order to implement polymorphism the right way, i.e, dynamic binding and LSP (Liskov Substitution Principle), we have to make the functions <code>virtual</code>, sometimes pure virtual, and then reimplement them in the Derived class with an <code>override</code> keyword.</p>
<p>We also need to separate the interface from the implementation, i.e, make the virtual function to be overriden <code>private</code>, and make a proxy <code>public</code> interface function in Base that simply calls the private function. We only need to reimplement the <code>private</code> <code>virtual</code> function in Derived. A simple example is shown below.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vCall</span><span class="params">()</span></span>; <span class="comment">// override in derived</span></span><br><span class="line">		<span class="comment">// virtual void vCall() = 0; // pure virtual, if base has nothing to do</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Base::call</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">vCall</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Base::vHello</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;Base vHello called\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>:</span> <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">vHello</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Derived::vHello</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;Derived vHello called\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Base *bp = <span class="keyword">new</span> Derived;</span><br><span class="line">	Base *bp1 = <span class="keyword">new</span> Base;</span><br><span class="line">	bp-&gt;<span class="built_in">hello</span>(); <span class="comment">// Derived</span></span><br><span class="line">	bp1-&gt;<span class="built_in">hello</span>(); <span class="comment">// Base</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is pretty standard when it comes to providing polymorphic support for some member functions. In addition, if Base class acquires some dynamic memory it also needs to free them, therefore providing a destructor, but the problem is, if Base only has a normal destructor, then using LSP, the Base pointer pointing to a Derived object, once out of scope, will trigger the destructor for Base class only, since there is no v_table entry for destructor, thus if Derived also has some dynamic allocation, they cannot be freed, leading to memory leak. Thus, we also have virtual destructors which work pretty much the same way.</p>
<h2 id="Virtual-Constructor"><a href="#Virtual-Constructor" class="headerlink" title="Virtual Constructor???"></a>Virtual Constructor???</h2><p>Well, it does not make sense. In order for virtual constructor to work, we need to have a v_ptr entry for the address of the constructor function.</p>
<p>but the constructor of a class should have the same type as the class itself. But at the time of construction, the type does not exist yet, as the class object hasn’t been created yet, so we don’t know what the v_ptr should point to, it creates a paradox.</p>
<p>At the same time, v_ptr and vtables are items instantiated for each class objects. There is no vtable before the object creation.</p>
<p>at the time of calling the constructor, <strong>the <a target="_blank" rel="noopener" href="https://www.learncpp.com/cpp-tutorial/the-virtual-table/">virtual table</a> would not have been created</strong> to resolve any virtual function calls. Thus, a virtual constructor itself would not have anywhere to look up to.</p>
<p>Such is the reason why the variants of constructors, such as copy or move constructors also cannot be made virtual.</p>
<p>But we can get around that problem using Prototype design pattern. We want to be able to create copies of a Derived object through a Base ptr or ref to that Derived obj (using LSP).</p>
<p>In this protocol, we make the Base class an abstract base class (ABC), with atleast one pure virtual function, and it does not have a copy constructor.</p>
<p>Generally, it has two functions, a public interface <code>clone()</code> and a private pure virtual, <code>copy()</code> signalling reimplementation in Derived classes.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="built_in">Base</span>(Base <span class="keyword">const</span> &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">		<span class="keyword">virtual</span> ~<span class="built_in">Base</span>();</span><br><span class="line">		<span class="function">Base *<span class="title">clone</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="function"><span class="keyword">virtual</span> Base *<span class="title">copy</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Base *<span class="title">Base::clone</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">copy</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// not inline</span></span><br><span class="line">Base::~<span class="built_in">Base</span>()</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>We offer a Wrapper class over Base that provides the copy functionalities:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wrapper</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	Base *d_bp;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="built_in">Wrapper</span>();</span><br><span class="line">		<span class="function"><span class="keyword">explicit</span> <span class="title">Wrapper</span><span class="params">(Wrapper *bp)</span></span>;</span><br><span class="line">		~<span class="built_in">Wrapper</span>();</span><br><span class="line">		<span class="built_in">Wrapper</span>(Wrapper <span class="keyword">const</span> &amp;other);</span><br><span class="line">		<span class="built_in">Wrapper</span>(Wrapper &amp;&amp;tmp);</span><br><span class="line">		Wrapper &amp;<span class="keyword">operator</span>=(Wrapper <span class="keyword">const</span> &amp;other);</span><br><span class="line">		Wrapper &amp;<span class="keyword">operator</span>=(Wrapper &amp;&amp;tmp);</span><br><span class="line">		<span class="function">Base &amp;<span class="title">getBase</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="title">Wrapper::Wrapper</span><span class="params">()</span></span></span><br><span class="line"><span class="function">:</span></span><br><span class="line"><span class="function">	d_bp(<span class="number">0</span>)</span></span><br><span class="line"><span class="function">&#123;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="title">Wrapper::Wrapper</span><span class="params">(Wrapper *bp)</span></span></span><br><span class="line"><span class="function">:</span></span><br><span class="line"><span class="function">	d_bp(bp)</span></span><br><span class="line"><span class="function">&#123;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> Wrapper::~<span class="built_in">Wrapper</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">delete</span> d_bp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="title">Wrapper::Wrapper</span><span class="params">(Wrapper <span class="keyword">const</span> &amp;other)</span></span></span><br><span class="line"><span class="function">:</span></span><br><span class="line"><span class="function">	d_bp(other.d_bp-&gt;clone())</span></span><br><span class="line"><span class="function">&#123;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="title">Wrapper::Wrapper</span><span class="params">(Wrapper &amp;&amp;tmp)</span></span></span><br><span class="line"><span class="function">:</span></span><br><span class="line"><span class="function">	d_bp(tmp.d_bp)</span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line">	tmp.d_bp = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Base &amp;<span class="title">Wrapper::getBase</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> *d_bp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Wrapper &amp;Wrapper::<span class="keyword">operator</span>=(Wrapper <span class="keyword">const</span> &amp;other)</span><br><span class="line">&#123;</span><br><span class="line">	Wrapper <span class="built_in">tmp</span>(other);</span><br><span class="line">	std::<span class="built_in">swap</span>(d_bp, tmp.d_bp);</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Wrapper &amp;Wrapper::<span class="keyword">operator</span>=(Wrapper &amp;&amp;tmp)</span><br><span class="line">&#123;</span><br><span class="line">	std::<span class="built_in">swap</span>(d_bp, tmp.d_bp);</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The Wrapper class exists to provide a unified copy-able interface for the entire family that derives from Base, all the Derived class needs to do is implement its <code>virtual copy()</code> method to return a new pointer to a copy of <code>this</code> </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>:</span> <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		~<span class="built_in">Derived</span>() <span class="keyword">override</span>;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="function">Base *<span class="title">copy</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Base *<span class="title">Derived::copy</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Derived</span>(*<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="No-Copy-move-constructor-for-polymorphic-Base"><a href="#No-Copy-move-constructor-for-polymorphic-Base" class="headerlink" title="No Copy/move constructor for polymorphic Base?"></a>No Copy/move constructor for polymorphic Base?</h2><p>According to C++ guidelines, C.67, <strong><strong>A polymorphic class should suppress public copy/move</strong></strong></p>
<p><a target="_blank" rel="noopener" href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-copy-virtual">C++ Core Guidelines</a></p>
<p>This is because, whenever the polymorphic Base class has implicitly defined copy/move constructors in place, </p>
<p>If it is accidentally passed by value, with the implicitly generated copy constructor and assignment, we risk slicing: only the base portion of a derived object will be copied, and the polymorphic behaviour will be corrupted.</p>
<p>This is why, we have to either delete the implicit copy/move constructor like we did in the last example, if the Base class does not have any data, or else make the constructors protected, so the copying can only be done from the context of Derived class.</p>
<p>For more example, the link is useful, check C.67 for this particular issue. –&gt;</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/cpp/" rel="tag">cpp</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/design-pattern/" rel="tag">design pattern</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/inheritance/" rel="tag">inheritance</a>

            </div>
        
        
        
            
                <div id="gitalk"></div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Shiladitya Bose. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Shiladitya Bose</h4>
        
            <div id="about-card-bio"><p>I like working on stuffs, and making stuffs work.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Engineer at Tata Consultancy Services Ltd.</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Kolkata, India
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.png');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-2ssuxofyypnsxvfaeadayhobdjy1rr1lmx51d3nvo0yeofwiu7o0qizwgl7p.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="/assets/js/gitalk.js"></script>

        <script type="text/javascript">
          (function() {
            new Gitalk({
              clientID: 'eb03e0259460d0df2e28',
              clientSecret: 'cb2cb7b150a4d0fd24187bc7fca73c09e0b4724e',
              repo: 's-bose.github.io',
              owner: 's-bose',
              admin: ['s-bose'],
              id: '2022/03/22/prototype-pattern/',
              ...{"language":"en","perPage":10,"distractionFreeMode":false,"enableHotKey":true,"pagerDirection":"first"}
            }).render('gitalk')
          })()
        </script>
    




    </body>
</html>
